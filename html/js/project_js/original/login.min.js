var global={userAddress:"",userAddressHex:"",tronscanName:"",username:"",loggedIn:!1,shortAddress:"",level:0,userSigned:!1};const horseNames=["Winnathunder","Trontrot","Troncruise","Spuntino","Blazer","DarkMatter","Mr. Ed","Redhorse"];var tokenContract="TAjAMF7XZGexASiQDfa8XJ1xFLcqtYNcrg",dividendContract="TAa3BAntM7Cz5RMcci8jtN3Q8yccxGwGnF",gameLocation1Contract="TVqdSYfGpPQXeBHQUgAAqqkgCiqmvQBY1p",tronNode="https://api.trongrid.io";const tW=require("tronweb"),privateKey="b551d8c006243277095acc3461f398cf9800685ab1d69742c758ae17306f125e",staticObject=new tW(tronNode,tronNode,tronNode,privateKey);var tokenContractInstance,dividendContractInstance,gameLocation1ContractInstance,tokenContractInstanceStatic,dividendContractInstanceStatic;function autotronLinkloginCheck(){let e=0;window.addEventListener("tronWebInjected",{once:!0}),a;const t=setInterval(()=>{const{tronWeb:n}=window;if(++e>4)return window.removeEventListener("tronWebInjected",{once:!0}),clearInterval(t);n&&n.ready&&(initGlobalData(),setCookie("tronLinkLoginTracker","1",10),clearInterval(t),dispatchEvent(new Event("tronWebInjected")))},1e3)}async function tronLinkloginCheck(){let e=0;window.addEventListener("tronWebInjected",{once:!0});const t=setInterval(()=>{const{tronWeb:n}=window;if(++e>4)return startLoginListener(),$("#login-popup").modal("show"),window.removeEventListener("tronWebInjected",{once:!0}),clearInterval(t);n&&n.ready&&(initGlobalData(),setCookie("tronLinkLoginTracker","1",10),clearInterval(t),dispatchEvent(new Event("tronWebInjected")))},1e3)}function startLoginListener(){var e=setInterval(()=>{window.tronWeb&&window.tronWeb.ready&&(window.tronWeb.eventServer.host.includes(tronNode)?(initGlobalData(),clearInterval(e)):(setTimeout(()=>{Toastify({text:"Look's like your are on wrong network. Change your network to Mainet from your wallet",backgroundColor:"Tomato",duration:1e4,stopOnFocus:!0,close:!0,className:"info"}).showToast()},2500),listenForNetworkChange(),clearInterval(e)))},1e3)}function listenForNetworkChange(){var e=setInterval(()=>{window.tronWeb&&window.tronWeb.ready&&window.tronWeb.eventServer.host.includes(tronNode)&&(initGlobalData(),clearInterval(e))},1e3)}async function initGlobalData(){global.shortAddress=getUserAddress(tronWeb.defaultAddress.base58),$("#userAddress").text(global.shortAddress),$("#isLoggedIn").hide(),global.tronscanName=await getTronscanName(tronWeb.defaultAddress.base58),global.userAddress=tronWeb.defaultAddress.base58,global.userAddressHex=tronWeb.defaultAddress.hex,global.loggedIn=!0;let e=null;try{e=await $.get(`${url}/isSigned/${global.userAddress}`)}catch(e){}global.userSigned=e.sign,getPlayerLevel(),initContractInstance()}function getUserAddress(e){return e.substring(0,5)+"..."+e.substr(e.length-5)}async function getPlayerLevel(){return new Promise(async function(e,t){try{const t=await $.get(`${url}/getLevel/${global.userAddress}`);global.level=t.level;var n,a=t.level;0==a?n="Visitor":a>=1&&a<=5?n="Shoveller":a>=6&&a<=10?n="Float Driver":a>=11&&a<=15?n="Barrier Attendant":a>=16&&a<=20?n="StableHand":a>=21&&a<=25?n="Track Rider":a>=26&&a<=30?n="Farrier":a>=31&&a<=35?n="Horse Breaker":a>=36&&a<=40?n="Strapper":a>=41&&a<=45?n="Effinex":a>=46&&a<=50?n="Apprentice":a>=51&&a<=55?n="Jockey":a>=56&&a<=60?n="Race Caller":a>=61&&a<=65?n="Thoroughbred Trainer":a>=66&&a<=70?n="Steward":a>=71&&a<=75?n="Bloodstock Agent":a>=76&&a<=80?n="Pro Syndicator":a>=81&&a<=85?n="First Dude":a>=86&&a<=90?n="G3 Owner":a>=91&&a<=95?n="G2 Owner":a>=96&&a<=98?n="G1 Owner":99==a?n="WINNA":100==a&&(n="Moderator"),global.username="[ LVL "+a+" | "+n+" ] "+global.tronscanName,e(!0)}catch(e){console.error(e)}})}function getTronscanName(e){return new Promise(function(t,n){var a="";$.ajax({url:"https://apilist.tronscan.org/api/account?address="+e,dataType:"json",async:!0,success:function(n){a=""!=n.name?n.name:getUserAddress(e),t(a)},error:function(n,o,r){a=getUserAddress(e),t(a)}})})}async function updateWonAmont(){try{response=await $.get(`${url}/wonAmount`);var e=parseInt(response.totalPaidAmt/1e6);$("#wonAmount").animateNumbers(e)}catch(e){}}$(document).ready(async function(){initInstanceStatic(),getCurrentLangAndWallet(),startLoginListener()}),$("#isLoggedIn").on("click",function(){0==global.loggedIn?$("#login-popup").modal("show"):autotronLinkloginCheck()}),setTimeout(function(){setInterval(updateWonAmont,3e4)},3e3);let intervalID=setInterval(async function(){if("object"==typeof window.tronWeb)try{var e=await window.tronWeb.defaultAddress.base58,t=await window.tronWeb.defaultAddress.hex;global.userAddress,""!=global.userAddress&&global.userAddress!=e&&(global.userAddress=e,global.userAddressHex=t,clearInterval(intervalID),location.reload())}catch(e){}},1e3);function getCurrentLangAndWallet(){var e=getCookie("language");"ru"==e?$("#currLang").text("Pусский"):"de"==e?$("#currLang").text("Deutsch"):"zh-CN"==e?$("#currLang").text("简体中文"):"kr"==e?$("#currLang").text("한국어"):"es"==e?$("#currLang").text("Español"):"po"==e?$("#currLang").text("Português"):"fr"==e?$("#currLang").text("Français"):(setCookie("language","en",5),$("#currLang").text("English"));var t=getCookie("wallet");"guild-wallet"==t?$("#currWallet").html('<img src="images/'+t+'.png">Guild Wallet'):(setCookie("wallet","tronlink",5),$("#currWallet").html('<img src="images/tronlink.png">TronLink'))}function setCookie(e,t,n){var a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3);var o="expires="+a.toGMTString();document.cookie=e+"="+t+";"+o+";path=/"}function getCookie(e){for(var t=e+"=",n=decodeURIComponent(document.cookie).split(";"),a=0;a<n.length;a++){for(var o=n[a];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""}async function nextDropTimer(){var e=await $.get(`${url}/nextDrop`),t=new Date(1e3*e.nextWinnaDrop),n=new Date(t).getTime(),a=setInterval(function(){var e,t,o,r=(new Date).getTime(),i=n-r;e=Math.floor(i%864e5/36e5),t=Math.floor(i%36e5/6e4),o=Math.floor(i%6e4/1e3),$("#nextWinnaDrop").text(e+":"+t+":"+o),i<0&&(clearInterval(a),$("#nextWinnaDrop").text("Distributing dividends..."))},1e3)}async function updateMintInfo(){try{var e=await tokenContractInstanceStatic.stage().call(),t=await tokenContractInstanceStatic.level().call(),n=await tokenContractInstanceStatic.getMintInfoByStageAndLevel(e,t).call(),a=await dividendContractInstanceStatic.availableMainDividendALL().call(),o=await dividendContractInstanceStatic.totalForzenWinnaAcrossNetwork().call(),r=staticObject.fromSun(n.difficulty),i=staticObject.fromSun(n.totalMintLimit),l=staticObject.fromSun(n.mintedTillNow),s=staticObject.fromSun(a[1]);if(a[0]||0==s?$("#availableWinnaDrop").text(parseFloat(s).toFixed(2).toLocaleString("en")+" TRX"):$("#availableWinnaDrop").text("-"+parseFloat(s).toFixed(2).toLocaleString("en")+" TRX"),o=staticObject.fromSun(o),$("#totalFrozenWinna").text(parseFloat(o).toFixed(2).toLocaleString("en")+" WINNA"),window.tronWeb&&window.tronWeb.ready&&window.tronWeb.eventServer.host.includes(tronNode)){var c=await dividendContractInstanceStatic.availableDividendIndividualLive(window.tronWeb.defaultAddress.base58).call();c=staticObject.fromSun(c),$("#playerDividend").text(parseFloat(c).toFixed(2).toLocaleString("en")+" TRX")}else $("#playerDividend").text("0 TRX");$("#stage").text(e),$("#level").text(t),$("#difficulty").text(r+" TRX"),$("#mintedtillNow").text(parseFloat(l).toFixed(2).toLocaleString("en")),$("#mintLimit").text(parseFloat(i).toLocaleString("en"));var d=l/i*100+"%";$("#progressBar").css({width:d})}catch(e){console.log("error",e)}}$(".walletDropDown").on("click",function(){var e=$(this).attr("name");"guild-wallet"==e?(setCookie("wallet",e,5),$("#currWallet").html('<img src="images/'+e+'.png">Guild Wallet')):(setCookie("wallet",e,5),$("#currWallet").html('<img src="images/'+e+'.png">TronLink'))}),$(".languageDropDown").on("click",function(){setCookie("language",$(this).attr("name"),30),location.reload(),$("#currLang").text($(this).text())}),nextDropTimer(),setInterval(updateMintInfo,4e3);var globalInfo={winnaBalance:0,frozenWinna:0,pendingWithdraw:0,withdrawTime:0,systemHalt:!1};async function updateWinnaInfo(){if(window.tronWeb&&window.tronWeb.ready&&window.tronWeb.eventServer.host.includes(tronNode))try{var e=await tokenContractInstance.balanceOf(window.tronWeb.defaultAddress.base58).call(),t=await dividendContractInstance.playerStackInfoByAddress(window.tronWeb.defaultAddress.base58).call(),n=await dividendContractInstance.dividendSystemHalt().call();globalInfo.winnaBalance=e.toNumber().toFixed(2)/1e6,e=e.toNumber()>0?e.toNumber().toFixed(2)/1e6+" WINNA":"0 WINNA";t.frozenWinna.toNumber()>0&&t.frozenWinna.toNumber().toFixed(2),t.pendingWithdraw.toNumber()>0&&t.pendingWithdraw.toNumber().toFixed(2),t.withdrawTime.toNumber();if(globalInfo.frozenWinna=t.frozenWinna.toNumber().toFixed(2)/1e6,globalInfo.pendingWithdraw=t.pendingWithdraw.toNumber().toFixed(2)/1e6,globalInfo.withdrawTime=t.withdrawTime.toNumber(),globalInfo.systemHalt=n,0!=globalInfo.withdrawTime){$("#claim").attr("disabled",!1);var a,o,r,i=new Date(1e3*globalInfo.withdrawTime),l=new Date(i).getTime(),s=new Date(i).toLocaleString();$("#unfreezeDate").text(s);var c=l-(new Date).getTime();a=Math.floor(c%864e5/36e5),o=Math.floor(c%36e5/6e4),r=Math.floor(c%6e4/1e3),$("#clock").text(a+":"+o+":"+r),$("#claimOrCancle").text("Cancle Unfreeze"),c<0&&($("#clock").text("0 : 00 : 00"),$("#claimOrCancle").text("Claim WINNA"))}else $("#claim").attr("disabled",!0);$("#availableWinna").val(globalInfo.winnaBalance+" WINNA"),$("#frozenWinna").val(globalInfo.frozenWinna+" WINNA"),$("#unfreezeAmt").val(globalInfo.pendingWithdraw+" WINNA"),$("#freezableWinna").text(globalInfo.winnaBalance+" WINNA"),$("#unfreezableWinna").text(globalInfo.frozenWinna+" WINNA"),$("#pendingFreezeeWinna").text(globalInfo.pendingWithdraw+" WINNA")}catch(e){$("#availableWinna").val("0 WINNA"),$("#frozenWinna").val("0 WINNA"),$("#unfreezeAmt").val("0 WINNA")}else $("#availableWinna").val("0 WINNA"),$("#frozenWinna").val("0 WINNA"),$("#unfreezeAmt").val("0 WINNA")}async function initContractInstance(){if(window.tronWeb&&window.tronWeb.ready&&window.tronWeb.eventServer.host.includes(tronNode))try{var e=await window.tronWeb.trx.getContract(tokenContract);tokenContractInstance=await window.tronWeb.contract(e.abi.entrys,e.contract_address);var t=await window.tronWeb.trx.getContract(dividendContract);dividendContractInstance=await window.tronWeb.contract(t.abi.entrys,t.contract_address)}catch(e){console.log("error",e)}}async function initInstanceStatic(){try{var e=await staticObject.trx.getContract(tokenContract);tokenContractInstanceStatic=await staticObject.contract(e.abi.entrys,e.contract_address);var t=await staticObject.trx.getContract(dividendContract);dividendContractInstanceStatic=await staticObject.contract(t.abi.entrys,t.contract_address)}catch(e){}}function waitForTxConfirmation(e){return new Promise(function(t,n){var a=setInterval(async function(){try{var n=await tronWeb.trx.getTransactionInfo(e);n&&("SUCCESS"==n.receipt.result?(clearInterval(a),t(!0)):(clearInterval(a),t(!1)))}catch(e){}},1e3)})}function waitForTxConfirmationEvent(e,t){return new Promise(function(n,a){var o=setInterval(async function(){try{var a=await tronWeb.getEventByTransactionID(e);if(a.length>=1)-1!=a.findIndex(e=>e.name===t)?(clearInterval(o),n(!0)):(clearInterval(o),n(!1))}catch(e){}},1e3)})}setTimeout(function(){setInterval(updateWinnaInfo,1e3)},3e3),$("#freezableWinna").on("click",function(){$("#frzAmt").val(globalInfo.winnaBalance)}),$("#unfreezableWinna").on("click",function(){$("#unfrzAmt").val(globalInfo.frozenWinna)}),$("#freeze").on("click",async function(){if(window.tronWeb&&window.tronWeb.ready&&window.tronWeb.eventServer.host.includes(tronNode))try{if(1==await dividendContractInstance.dividendSystemHalt().call())return void Toastify({text:"We are distributing dividend.<br> All Functionality is not accesable at the moment",backgroundColor:"Tomato",duration:1e4,stopOnFocus:!0,close:!0,className:"info"}).showToast();$("#freezeWinnaModal").modal("show")}catch(e){}else $("#login-popup").modal("show")}),$("#frzAmt").on("keyup",function(){var e=$("#frzAmt").val();isNaN(e)?$("#frzAmt").val(0):0==globalInfo.winnaBalance?$("#frzAmt").val(0):e>globalInfo.winnaBalance&&$("#frzAmt").val(globalInfo.winnaBalance)}),$("#freezeConfirm").on("click",async function(){if(window.tronWeb&&window.tronWeb.ready&&window.tronWeb.eventServer.host.includes(tronNode)){var e=$("#frzAmt").val();try{var t=await window.tronWeb.defaultAddress.base58;if((await tokenContractInstanceStatic.playerMintInfo(t).call()).totalBets.toNumber()>=867e7)if(""!=e&&e>=1){e=window.tronWeb.toSun(e);try{var n=await tokenContractInstance.approveAndFreeze(e).send({shouldPollResponse:!1,feeLimit:5e6});await waitForTxConfirmationEvent(n,"FreezeWinna")?(Toastify({text:"Successfully Frozen WINNA",backgroundColor:"MediumSeaGreen",duration:1e4,close:!0,className:"info"}).showToast(),$("#frzAmt").val(""),$("#freezeWinnaModal").modal("hide")):(console.log("error",error),Toastify({text:"Transaction Failed!",backgroundColor:"Tomato",duration:1e4,close:!0,className:"info"}).showToast(),$("#frzAmt").val(""))}catch(e){console.log("error",e),Toastify({text:"Transaction Failed!",backgroundColor:"Tomato",duration:1e4,close:!0,className:"info"}).showToast(),$("#frzAmt").val("")}}else Toastify({text:"Minimum Freeze amount is 1 WINNA",backgroundColor:"Tomato",duration:1e4,close:!0,className:"info"}).showToast(),$("#frzAmt").val("");else Toastify({text:"You need to have minimum level 3 to start freezing WINNA",backgroundColor:"Tomato",duration:1e4,close:!0,className:"info"}).showToast(),$("#frzAmt").val("")}catch(e){console.log(e)}}else $("#login-popup").modal("show")}),$("#unfreeze").on("click",async function(){if(window.tronWeb&&window.tronWeb.ready&&window.tronWeb.eventServer.host.includes(tronNode))try{var e=await dividendContractInstance.dividendSystemHalt().call(),t=(await dividendContractInstance.playerStackInfoByAddress(global.userAddress).call()).pendingWithdraw.toNumber().toFixed(2)/1e6;if(1==e)return void Toastify({text:"We are distributing dividend.<br> All Functionality is not accesable at the moment",backgroundColor:"Tomato",duration:1e4,stopOnFocus:!0,close:!0,className:"info"}).showToast();if(0!=t)return void Toastify({text:"You have already pending frozen winna.<br>You can unfreeze after claiming that or cancle that unfreeze process",backgroundColor:"Tomato",duration:1e4,stopOnFocus:!0,close:!0,className:"info"}).showToast();$("#unfreezeWinnaModal").modal("show")}catch(e){}else $("#login-popup").modal("show")}),$("#unfrzAmt").on("keyup",function(){var e=$("#unfrzAmt").val();isNaN(e)?$("#unfrzAmt").val(0):0==globalInfo.frozenWinna?$("#unfrzAmt").val(0):e>globalInfo.frozenWinna&&$("#unfrzAmt").val(globalInfo.frozenWinna)}),$("#unfreezeConfirm").on("click",async function(){if(window.tronWeb&&window.tronWeb.ready&&window.tronWeb.eventServer.host.includes(tronNode)){var e=$("#unfrzAmt").val();if(""!=e&&e>=1){e=window.tronWeb.toSun(e);try{var t=await dividendContractInstance.Unfreeze(e).send({shouldPollResponse:!1,feeLimit:5e6});await waitForTxConfirmationEvent(t,"UnfreezeWinna")?($("#unfreezeWinnaModal").modal("hide"),Toastify({text:"Successfully Unfrozen WINNA",backgroundColor:"MediumSeaGreen",duration:1e4,close:!0,className:"info"}).showToast(),$("#unfrzAmt").val("")):(Toastify({text:"Transaction Failed!",backgroundColor:"Tomato",duration:1e4,close:!0,className:"info"}).showToast(),$("#unfrzAmt").val(""))}catch(e){Toastify({text:"Transaction Failed!",backgroundColor:"Tomato",duration:1e4,close:!0,className:"info"}).showToast(),$("#unfrzAmt").val(""),console.log("error",e)}}else Toastify({text:"Minimum Unfreeze amount is 1 WINNA",backgroundColor:"Tomato",duration:1e4,close:!0,className:"info"}).showToast(),$("#unfrzAmt").val("")}else $("#login-popup").modal("show")}),$("#claim").on("click",function(){window.tronWeb&&window.tronWeb.ready&&window.tronWeb.eventServer.host.includes(tronNode)?$("#claimWinnaModal").modal("show"):$("#login-popup").modal("show")}),$("#claimOrCancle").on("click",async function(){if(window.tronWeb&&window.tronWeb.ready&&window.tronWeb.eventServer.host.includes(tronNode))try{var e=(await dividendContractInstance.playerStackInfoByAddress(global.userAddress).call()).withdrawTime.toNumber(),t=parseInt(Date.now()/1e3);if(e<t&&0!=e)try{var n=await dividendContractInstance.ClaimWinna().send({shouldPollResponse:!1,feeLimit:3e6});await waitForTxConfirmationEvent(n,"WithdrawWinna")?($("#claimWinnaModal").modal("hide"),Toastify({text:"Successfully Claimed WINNA. <br>It is credited to your account.",backgroundColor:"MediumSeaGreen",duration:1e4,close:!0,className:"info"}).showToast()):(Toastify({text:"Transaction Failed!",backgroundColor:"Tomato",duration:1e4,close:!0,className:"info"}).showToast(),console.log("error",error))}catch(e){Toastify({text:"Transaction Failed!",backgroundColor:"Tomato",duration:1e4,close:!0,className:"info"}).showToast(),console.log("error",e)}else if(e>t&&0!=e)try{var a=await dividendContractInstance.CancleUnfreeze().send({shouldPollResponse:!1,feeLimit:3e6});await waitForTxConfirmationEvent(a,"UnfreezeWinnaCancle")?($("#claimWinnaModal").modal("hide"),Toastify({text:"WINNA unfrozen process cancled",backgroundColor:"MediumSeaGreen",duration:1e4,close:!0,className:"info"}).showToast()):(Toastify({text:"Transaction Failed!",backgroundColor:"Tomato",duration:1e4,close:!0,className:"info"}).showToast(),console.log("error",error))}catch(e){Toastify({text:"Transaction Failed!",backgroundColor:"Tomato",duration:1e4,close:!0,className:"info"}).showToast(),console.log("error",e)}else $("#login-popup").modal("show")}catch(e){}});