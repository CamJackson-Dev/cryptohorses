var global={userAddress:"",userAddressHex:"",tronscanName:"",username:"",loggedIn:!1,shortAddress:"",level:0,userSigned:!1},tronNode="https://api.trongrid.io";function autotronLinkloginCheck(){let e=0;window.addEventListener("tronWebInjected",{once:!0}),a;const t=setInterval(()=>{const{tronWeb:n}=window;if(++e>4)return window.removeEventListener("tronWebInjected",{once:!0}),clearInterval(t);n&&n.ready&&(initGlobalData(),setCookie("tronLinkLoginTracker","1",10),clearInterval(t),dispatchEvent(new Event("tronWebInjected")))},1e3)}async function tronLinkloginCheck(){let e=0;window.addEventListener("tronWebInjected",{once:!0});const t=setInterval(()=>{const{tronWeb:n}=window;if(++e>4)return startLoginListener(),$("#login-popup").modal("show"),window.removeEventListener("tronWebInjected",{once:!0}),clearInterval(t);n&&n.ready&&(initGlobalData(),setCookie("tronLinkLoginTracker","1",10),clearInterval(t),dispatchEvent(new Event("tronWebInjected")))},1e3)}function startLoginListener(){var e=setInterval(()=>{window.tronWeb&&window.tronWeb.ready&&(window.tronWeb.eventServer.host.includes(tronNode)?(initGlobalData(),clearInterval(e)):(setTimeout(()=>{Toastify({text:"Look's like your are on wrong network. Change your network to Mainet from your wallet",backgroundColor:"Tomato",duration:1e4,stopOnFocus:!0,close:!0,className:"info"}).showToast()},2500),listenForNetworkChange(),clearInterval(e)))},1e3)}function listenForNetworkChange(){var e=setInterval(()=>{window.tronWeb&&window.tronWeb.ready&&window.tronWeb.eventServer.host.includes(tronNode)&&(initGlobalData(),clearInterval(e))},1e3)}async function initGlobalData(){global.shortAddress=getUserAddress(window.tronWeb.defaultAddress.base58),$("#userAddress").text(global.shortAddress),$("#isLoggedIn").hide(),global.tronscanName=await getTronscanName(tronWeb.defaultAddress.base58),global.userAddress=window.tronWeb.defaultAddress.base58,global.userAddressHex=window.tronWeb.defaultAddress.hex,global.loggedIn=!0;let e=null;try{e=await $.get(`${url}/isSigned/${global.userAddress}`)}catch(e){}global.userSigned=e.sign,getPlayerLevel()}function getUserAddress(e){return e.substring(0,5)+"..."+e.substr(e.length-5)}async function getPlayerLevel(){return new Promise(async function(e,t){try{const t=await $.get(`${url}/getLevel/${global.userAddress}`);global.level=t.level;var n,r=t.level;0==r?n="Visitor":r>=1&&r<=5?n="Shoveller":r>=6&&r<=10?n="Float Driver":r>=11&&r<=15?n="Barrier Attendant":r>=16&&r<=20?n="StableHand":r>=21&&r<=25?n="Track Rider":r>=26&&r<=30?n="Farrier":r>=31&&r<=35?n="Horse Breaker":r>=36&&r<=40?n="Strapper":r>=41&&r<=45?n="Effinex":r>=46&&r<=50?n="Apprentice":r>=51&&r<=55?n="Jockey":r>=56&&r<=60?n="Race Caller":r>=61&&r<=65?n="Thoroughbred Trainer":r>=66&&r<=70?n="Steward":r>=71&&r<=75?n="Bloodstock Agent":r>=76&&r<=80?n="Pro Syndicator":r>=81&&r<=85?n="First Dude":r>=86&&r<=90?n="G3 Owner":r>=91&&r<=95?n="G2 Owner":r>=96&&r<=99?n="G1 Owner":100==r&&(n="WINNA"),global.username="[ LVL "+r+" | "+n+" ] "+global.tronscanName,e(!0)}catch(e){console.error(e)}})}function getTronscanName(e){return new Promise(function(t,n){var r="";$.ajax({url:"https://apilist.tronscan.org/api/account?address="+e,dataType:"json",async:!0,success:function(n){r=""!=n.name?n.name:getUserAddress(e),t(r)},error:function(n,o,a){r=getUserAddress(e),t(r)}})})}async function updateWonAmont(){try{response=await $.get(`${url}/wonAmount`),odometer.innerHTML=parseInt(response.totalPaidAmt/1e6)}catch(e){}}$(document).ready(async function(){listClick("all"),allbetsLast50(),initInstanceStatic(),getCurrentLangAndWallet(),startLoginListener()}),$("#isLoggedIn").on("click",function(){0==global.loggedIn?$("#login-popup").modal("show"):autotronLinkloginCheck()}),setTimeout(function(){setInterval(updateWonAmont,30e3)},6e3);let intervalID=setInterval(async function(){if("object"==typeof window.tronWeb)try{var e=await window.tronWeb.defaultAddress.base58,t=await window.tronWeb.defaultAddress.hex;global.userAddress,""!=global.userAddress&&global.userAddress!=e&&(global.userAddress=e,global.userAddressHex=t,clearInterval(intervalID),location.reload())}catch(e){}},1e3);function getCurrentLangAndWallet(){var e=getCookie("language");"ru"==e?$("#currLang").text("Pусский"):"de"==e?$("#currLang").text("Deutsch"):"zh-CN"==e?$("#currLang").text("简体中文"):"kr"==e?$("#currLang").text("한국어"):"es"==e?$("#currLang").text("Español"):"po"==e?$("#currLang").text("Português"):"fr"==e?$("#currLang").text("Français"):(setCookie("language","en",5),$("#currLang").text("English"));var t=getCookie("wallet");"guild-wallet"==t?$("#currWallet").html('<img src="images/'+t+'.png">Guild Wallet'):(setCookie("wallet","tronlink",5),$("#currWallet").html('<img src="images/tronlink.png">TronLink'))}function setCookie(e,t,n){var r=new Date;r.setTime(r.getTime()+24*n*60*60*1e3);var o="expires="+r.toGMTString();document.cookie=e+"="+t+";"+o+";path=/"}function getCookie(e){for(var t=e+"=",n=decodeURIComponent(document.cookie).split(";"),r=0;r<n.length;r++){for(var o=n[r];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""}$(".walletDropDown").on("click",function(){var e=$(this).attr("name");"guild-wallet"==e?(setCookie("wallet",e,5),$("#currWallet").html('<img src="images/'+e+'.png">Guild Wallet')):(setCookie("wallet",e,5),$("#currWallet").html('<img src="images/'+e+'.png">TronLink'))}),$(".languageDropDown").on("click",function(){setCookie("language",$(this).attr("name"),30),location.reload(),$("#currLang").text($(this).text())});let roomName="";var socket=io();function scrollToBottom(){var e=jQuery("#messages"),t=e.prop("scrollHeight");e.scrollTop(t)}function listClick(e){roomName=e,$("#messages").empty(),socket.emit("join",{room:e,username:global.username,address:global.userAddress})}function getUserameClass(e){return e>=1&&e<=24?"usernames1":e>=25&&e<=49?"usernames2":e>=50&&e<=74?"usernames3":e>=75&&e<=98?"usernames4":99==e?"usernames5":void 0}$(".changeChatRoom").on("click",function(){listClick($(this).attr("name"))}),socket.on("connect",function(){}),socket.on("disconnect",function(){}),socket.on("getMessage",async({address:e})=>{try{(await $.get(`${url}/chat/${roomName}`)).chats.forEach(({userName:t,userAddress:n,message:r,level:o})=>{var a=jQuery(`#${e===n?"message-template-sender":"message-template-receiver"}`).html(),s=getUserameClass(o),l=Mustache.render(a,{color:s,userName:t,message:r,image:"1"});jQuery("#messages").prepend(l)}),scrollToBottom()}catch(e){}}),socket.on("newMessage",function({userName:e,message:t,level:n}){const r=e===global.username?"message-template-sender":"message-template-receiver";var o=jQuery(`#${r}`).html(),a=getUserameClass(n),s=Mustache.render(o,{color:a,userName:e,message:t,image:"1"});jQuery("#messages").append(s),scrollToBottom()}),jQuery("#all-chats-form").on("submit",async e=>{if(e.preventDefault(),window.tronWeb&&window.tronWeb.ready&&window.tronWeb.eventServer.host.includes(tronNode))if(0==global.userSigned){let r=!1;try{r=(await $.get(`${url}/check/player/${global.userAddress}`)).flag}catch(e){}if(!r)return Toastify({text:"You need to have level 5 to get chat access.",backgroundColor:"Tomato",duration:1e4,stopOnFocus:!0,close:!0,className:"info"}).showToast(),$(".textarea-chat-inputfield").text(""),void $(".textarea-chat-inputfield").val("");var t=window.tronWeb.toHex("tronhorses");t=t.substring(2);try{var n=await window.tronWeb.trx.sign(t);""!=n&&socket.emit("signChat",{userAddress:global.userAddress,sign:n},function(){global.userSigned=!0,$("#sendMsg").trigger("click")})}catch(e){}}else try{await getPlayerLevel();var r,o=$(".textarea-chat-inputfield").val(),a=$(".textarea-chat-inputfield").text();r=(r=o.length<=2&&""!=a?o+a:o.length>=4&&!o.includes(a)?o+a:o).substring(0,127);const e={userAddress:global.userAddress,userName:global.username,level:global.level,message:r,room:roomName};socket.emit("createMessage",e,function(){$(".textarea-chat-inputfield").text(""),$(".textarea-chat-inputfield").val("")})}catch(e){console.log(e),e.responseText.includes("is less than minimum allowed value")&&(Toastify({text:"You need to have minimum Level 5 to get Chat access",backgroundColor:"Tomato",duration:1e4,stopOnFocus:!0,close:!0,className:"info"}).showToast(),$(".textarea-chat-inputfield").text(""),$(".textarea-chat-inputfield").val(""))}else $("#login-popup").modal("show")}),$("#all-chats-form").on("keydown",".textarea-chat-inputfield",function(e){if(13==e.which)return $("form#all-chats-form").submit(),!1});